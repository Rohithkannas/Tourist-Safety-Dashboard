<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Geofence & Risk Zones â€¢ Tourist Safety</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script> tailwind.config = { theme: { extend: { colors: { bgdark: '#000000' } } } } </script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="./assets/css/styles.css" />
  <style>
    body { background:#000; }
    .header-line { height:1px; background:rgba(255,255,255,0.18); }
  </style>
</head>
<body class="text-white">
  <div class="header-line"></div>
  <header class="topbar">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="text-sm tracking-wide text-white/80" data-i18n="app_title">Tourist Safety Dashboard</div>
      <nav class="text-sm flex items-center gap-2">
        <a href="./dashboard.html" class="btn" data-i18n="nav_dashboard">Dashboard</a>
        <a href="./alerts.html" class="btn" data-i18n="nav_alerts">Alerts</a>
        <a href="./analytics.html" class="btn" data-i18n="nav_analytics">Analytics</a>
        <a href="./audit.html" class="btn" data-i18n="nav_audit">Audit</a>
        <a href="./settings.html" class="btn" data-i18n="nav_settings">Settings</a>
      </nav>
    </div>
  </header>
  <div class="header-line"></div>

  <main class="max-w-7xl mx-auto px-4 py-6 grid lg:grid-cols-3 gap-6">
    <section class="lg:col-span-2 p-4 border border-white/10 rounded-lg bg-white/5">
      <h2 class="font-semibold mb-3" data-i18n="nav_geofence">Geofence & Risk Zones</h2>
      <div id="map" class="w-full h-[520px] rounded-md overflow-hidden border border-white/10"></div>
      <p class="mt-3 text-xs text-white/70">Click on the map to add polygon vertices. Double-click to finish. Save to apply globally (demo saves to localStorage).</p>
      <div class="mt-3 flex gap-2">
        <button id="btnUndo" class="px-3 py-2 rounded-md border border-white/20 hover:bg-white/10">Undo point</button>
        <button id="btnClear" class="px-3 py-2 rounded-md border border-white/20 hover:bg-white/10">Clear</button>
        <button id="btnSave" class="px-3 py-2 rounded-md bg-white text-black hover:bg-gray-200">Save</button>
      </div>
    </section>
    <section class="p-4 border border-white/10 rounded-lg bg-white/5 space-y-3">
      <h2 class="font-semibold">AI-Predicted Risk (Demo)</h2>
      <p class="text-sm text-white/70">Highlighted sectors indicate predicted high-risk areas based on recent alerts and tourist density patterns.</p>
      <ul class="text-sm list-disc list-inside text-white/80">
        <li>Sector A12: border proximity</li>
        <li>Sector C04: dense footfall</li>
        <li>Sector D21: weather warnings</li>
      </ul>
      <h2 class="font-semibold mt-4">Device Assignment (Demo)</h2>
      <p class="text-sm text-white/70">Track which device/band is assigned to which tourist (placeholder).</p>
    </section>
  </main>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="./assets/js/i18n.js"></script>
  <script>
    // Theme + language
    (function(){ const t = localStorage.getItem('theme')||'dark'; if (t==='light') document.body.classList.add('light'); })();
    I18N.apply();

    let drawing = [];
    let polygonLayer = null;
    const map = L.map('map').setView([26.9124, 75.7873], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);

    function renderPolygon(){
      if (polygonLayer) { map.removeLayer(polygonLayer); }
      if (drawing.length >= 3){ polygonLayer = L.polygon(drawing, { color:'#eab308', weight:2, fillOpacity:0.08 }).addTo(map); }
    }

    map.on('click', (e)=>{ drawing.push([e.latlng.lat, e.latlng.lng]); renderPolygon(); });
    map.on('dblclick', ()=>{ /* finish drawing */ });

    document.getElementById('btnUndo').onclick = ()=>{ drawing.pop(); renderPolygon(); };
    document.getElementById('btnClear').onclick = ()=>{ drawing = []; renderPolygon(); };
    document.getElementById('btnSave').onclick = ()=>{
      if (drawing.length < 3) { alert('Add at least 3 points.'); return; }
      localStorage.setItem('restrictedPolygon', JSON.stringify(drawing));
      alert('Saved locally. Dashboard will use this polygon on reload.');
    };
  </script>
</body>
</html>
